{% extends 'layouts/admin_base.html' %}
{% block title %}Manage Users{% endblock %}
{% block header_title %}<h1><i class="fas fa-users"></i> Manage Users</h1>{% endblock %}
{% block content %}
<div class="table-container glass-effect">
  <div class="table-responsive">
    <table class="modern-table">
      <thead>
        <tr>
          <th>ID</th><th>Username</th><th>Email</th><th>Active</th><th>Joined</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for u in users %}
          <tr class="table-row">
            <td>#{{ u.id }}</td>
            <td>{{ u.username }}</td>
            <td>{{ u.email }}</td>
            <td>{% if u.is_active %}<span class="status-badge active">Active</span>{% else %}<span class="status-badge inactive">Inactive</span>{% endif %}</td>
            <td>{{ u.date_joined|date:"M d, Y" }}</td>
            <td>
              <button class="btn btn-sm btn-outline" onclick="openEditUserModal({{ u.id }}, '{{ u.first_name|escapejs }}', '{{ u.last_name|escapejs }}', '{{ u.email|escapejs }}', '{{ u.role|default:'' }}', {{ u.is_active|lower }})"><i class="fas fa-edit"></i></button>
              <a class="btn btn-sm btn-secondary" href="{% url 'toggle_user_status' u.id %}">Toggle Status</a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6"><div class="empty-state"><i class="fas fa-users"></i><p>No users</p></div></td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Edit User Modal -->
<div id="editUserModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit User</h3>
      <button class="modal-close" onclick="closeEditUserModal()">&times;</button>
    </div>
    <form method="post" id="editUserForm">
      {% csrf_token %}
      <input type="text" name="first_name" id="edit_first_name" placeholder="First Name">
      <input type="text" name="last_name" id="edit_last_name" placeholder="Last Name">
      <input type="email" name="email" id="edit_email" placeholder="Email" required>
      <select name="role" id="edit_role">
        <option value="">Select Role</option>
        <option value="student">Student</option>
        <option value="teacher">Teacher</option>
        <option value="admin">Admin</option>
      </select>
      <label><input type="checkbox" name="is_active" id="edit_is_active"> Active</label>
      <div class="modal-actions">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn" onclick="closeEditUserModal()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
function openEditUserModal(id, firstName, lastName, email, role, isActive) {
  document.getElementById('edit_first_name').value = firstName || '';
  document.getElementById('edit_last_name').value = lastName || '';
  document.getElementById('edit_email').value = email;
  document.getElementById('edit_role').value = role || '';
  document.getElementById('edit_is_active').checked = isActive;
  document.getElementById('editUserForm').action = `/admin/users/${id}/edit/`;
  document.getElementById('editUserModal').style.display = 'flex';
}
function closeEditUserModal() {
  document.getElementById('editUserModal').style.display = 'none';
}
</script>
{% endblock %}
